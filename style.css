this modified by shor branch
